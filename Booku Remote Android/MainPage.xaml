<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BookuRemoteAndroid.MainPage"
             Title="Booku Remote">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="âš™ï¸"
                     Order="Primary"
                     Clicked="OnSettingsClicked" />
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto" Padding="16">

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <VerticalStackLayout Spacing="8">
                <Label Text="Booku Remote"
                       Style="{StaticResource LabelTitle}" />
                <Label Text="Hubungkan ke Host untuk memulai remote desktop"
                       Style="{StaticResource LabelSubtitle}" />
            </VerticalStackLayout>
        </Grid>

        <!-- Mode Selector (LAN / Internet) -->
        <Frame Grid.Row="1"
               BackgroundColor="{StaticResource Surface}"
               BorderColor="{StaticResource Neutral300}"
               CornerRadius="12"
               Padding="4"
               Margin="0,0,0,12"
               HasShadow="False">
            <Grid ColumnDefinitions="*,*" ColumnSpacing="4">
                <Button Grid.Column="0"
                        x:Name="btnModeLAN"
                        Text="ðŸ“¡ Mode LAN"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="{StaticResource White}"
                        Clicked="OnModeLANClicked" />
                <Button Grid.Column="1"
                        x:Name="btnModeInternet"
                        Text="ðŸŒ Mode Internet"
                        BackgroundColor="{StaticResource Surface}"
                        TextColor="{StaticResource TextPrimary}"
                        Clicked="OnModeInternetClicked" />
            </Grid>
        </Frame>

        <!-- Internet Mode Section (HostCode Input) -->
        <Frame Grid.Row="2"
               x:Name="frameInternetMode"
               BackgroundColor="{StaticResource Surface}"
               BorderColor="{StaticResource Primary}"
               CornerRadius="12"
               Padding="16"
               Margin="0,0,0,12"
               HasShadow="False"
               IsVisible="False">
            <VerticalStackLayout Spacing="12">
                <Label Text="Koneksi via Internet (Relay Server)"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Primary}" />
                <Label Text="Masukkan kode Host yang ditampilkan di komputer tujuan"
                       FontSize="12"
                       TextColor="{StaticResource TextSecondary}" />
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                    <Entry Grid.Column="0"
                           x:Name="entryHostCode"
                           Placeholder="Masukkan Kode Host (6 karakter)"
                           MaxLength="6"
                           Keyboard="Text"
                           CharacterSpacing="4"
                           ClearButtonVisibility="WhileEditing"
                           TextChanged="OnHostCodeTextChanged" />
                    <Button Grid.Column="1"
                            x:Name="btnConnectRelay"
                            Text="Sambung"
                            WidthRequest="100"
                            IsEnabled="False"
                            Clicked="OnConnectRelayClicked" />
                </Grid>
                <VerticalStackLayout x:Name="stackHostInfo" IsVisible="False" Spacing="4">
                    <Label x:Name="lblHostName"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}" />
                    <Label x:Name="lblHostStatus"
                           FontSize="12"
                           TextColor="{StaticResource TextSecondary}" />
                </VerticalStackLayout>
            </VerticalStackLayout>
        </Frame>

        <!-- LAN Mode Section (Manual IP) -->
        <Frame Grid.Row="2"
               x:Name="frameLANMode"
               BackgroundColor="{StaticResource Surface}"
               BorderColor="{StaticResource Primary}"
               CornerRadius="12"
               Padding="16"
               Margin="0,0,0,12"
               HasShadow="False">
            <VerticalStackLayout Spacing="12">
                <Label Text="Koneksi Manual (untuk Emulator/Testing)"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Primary}" />
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                    <Entry Grid.Column="0"
                           x:Name="entryManualIP"
                           Placeholder="Masukkan IP Host (contoh: 10.0.2.2)"
                           Keyboard="Telephone"
                           ClearButtonVisibility="WhileEditing"
                           TextChanged="OnManualIPTextChanged" />
                    <Button Grid.Column="1"
                            x:Name="btnConnectManual"
                            Text="Sambung"
                            WidthRequest="100"
                            IsEnabled="False"
                            Clicked="OnConnectManualClicked" />
                </Grid>
                <Label Text="ðŸ’¡ Untuk emulator Android, gunakan IP 10.0.2.2 untuk mengakses PC host"
                       FontSize="11"
                       TextColor="{StaticResource TextSecondary}" />
            </VerticalStackLayout>
        </Frame>

        <!-- Device List -->
        <RefreshView Grid.Row="3"
                     x:Name="refreshView"
                     IsRefreshing="{Binding IsScanning}"
                     Command="{Binding ScanCommand}">

            <CollectionView x:Name="collectionDevices"
                            ItemsSource="{Binding Devices}"
                            SelectionMode="Single"
                            SelectionChanged="OnDeviceSelected"
                            EmptyView="Tidak ada perangkat Host ditemukan.&#10;Tekan tombol Scan untuk mencari.">

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Style="{StaticResource CardDevice}">
                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">

                                <!-- Icon -->
                                <Frame Grid.Column="0"
                                       BackgroundColor="{StaticResource PrimarySurface}"
                                       CornerRadius="8"
                                       Padding="12"
                                       HasShadow="False"
                                       VerticalOptions="Center">
                                    <Label Text="ðŸ–¥ï¸" FontSize="24" />
                                </Frame>

                                <!-- Device Info -->
                                <VerticalStackLayout Grid.Column="1"
                                                     VerticalOptions="Center"
                                                     Spacing="4">
                                    <Label Text="{Binding NamaPerangkat}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}" />
                                    <Label Text="{Binding AlamatIP}"
                                           FontSize="14"
                                           TextColor="{StaticResource TextSecondary}" />
                                </VerticalStackLayout>

                                <!-- Status -->
                                <Frame Grid.Column="2"
                                       BackgroundColor="{Binding StatusColor}"
                                       CornerRadius="12"
                                       Padding="12,6"
                                       HasShadow="False"
                                       VerticalOptions="Center">
                                    <Label Text="{Binding StatusText}"
                                           FontSize="12"
                                           TextColor="{StaticResource White}" />
                                </Frame>

                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>
        </RefreshView>

        <!-- Loading Overlay -->
        <Grid Grid.Row="3"
              x:Name="gridLoading"
              IsVisible="False"
              BackgroundColor="#80000000">
            <VerticalStackLayout VerticalOptions="Center"
                                 HorizontalOptions="Center"
                                 Spacing="16">
                <ActivityIndicator IsRunning="True"
                                   HeightRequest="48"
                                   WidthRequest="48"
                                   Color="{StaticResource White}" />
                <Label x:Name="lblLoadingStatus"
                       Text="Menghubungkan..."
                       TextColor="{StaticResource White}"
                       FontSize="16"
                       HorizontalOptions="Center" />
            </VerticalStackLayout>
        </Grid>

        <!-- Bottom Buttons -->
        <Grid Grid.Row="4" ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,16,0,0">
            <Button Grid.Column="0"
                    x:Name="btnScan"
                    Text="ðŸ” Scan"
                    Clicked="OnScanClicked" />
            <Button Grid.Column="1"
                    x:Name="btnConnect"
                    Text="ðŸ”— Sambungkan"
                    IsEnabled="False"
                    Clicked="OnConnectClicked" />
        </Grid>

    </Grid>

</ContentPage>
